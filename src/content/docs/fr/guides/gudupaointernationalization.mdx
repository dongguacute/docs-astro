---
title: Plugin Gudupao Astro I18n
sidebar:
 label: Plugin Gudupao Astro I18n
description: Plugin i18n pour Astro avec prise en charge de {{t.xxx}}, de packs de langues locaux, de changement de langue et de compatibilité avec SSR et SSG.
i18nReady: true
---

Notre plugin fournit une solution i18n complète pour les projets Astro, conçue pour être intuitive et puissante :

- Routage multilingue flexible : prend en charge le routage basé sur le chemin et sans chemin.
- Détection automatique de la langue : détecte la langue du navigateur de l'utilisateur avec des replis élégants.
- Packs de langues personnalisables : permet aux développeurs de définir et d'organiser les traductions dans des fichiers JSON locaux.
- Syntaxe de traduction simple : les traductions sont accessibles via \{\{t.xxx\}\} pour plus de clarté et de maintenabilité.
- Changement de langue transparent : permet de changer la langue à l'exécution sans complexité.
- Compatibilité des modes : prend entièrement en charge les modes SSR (dynamique) et SSG (statique) d'Astro.
- Prise en charge multi-cadres : fonctionne avec les trois langages d'écriture principaux d'Astro — Astro, React et Vue.

## Installation

```
pnpm add @gudupao/astro-i18n
```



## Configuration

### Aperçu

Astro-i18n peut être configuré avec diverses options pour personnaliser son comportement. Ce document détaille chaque option de configuration, son objectif et sa valeur par défaut.

Astro-i18n prend en charge deux modes principaux de fonctionnement :
- **Basé sur le chemin **: Les langues sont identifiées par les chemins d'URL (par exemple, `/en/about`, `/zh/about`). Ceci est contrôlé par l'option `pathBasedRouting`.
- **Sans chemin **: La langue est déterminée par d'autres moyens (cookie, en-tête Accept-Language) sans modifier le chemin d'URL. Ceci est également contrôlé par l'option `pathBasedRouting`.

### Options de configuration communes

Ces options sont disponibles pour les modes basés sur le chemin et sans chemin.

#### `localesDir`

- **Type **: `string`
- **Description **: Le répertoire où vos fichiers de paramètres régionaux sont stockés.
- **Par défaut **: `'locales'`

Exemple :
```typescript
integrations: [
  astroI18nPlugin({
    localesDir: './my-locales'
 })
]
```

#### `fallbackLang`

- **Type **: `string`
- **Description **: La langue de secours si une traduction n'est pas trouvée pour la langue actuelle.
- **Par défaut **: `'en'`

Exemple :
```typescript
integrations: [
 astroI18nPlugin({
    fallbackLang: 'zh'
  })
]
```

#### `autoDetectLanguage`

- **Type **: `boolean`
- **Description **: Indique s'il faut détecter automatiquement la langue de l'utilisateur à partir de l'en-tête Accept-Language.
- **Par défaut **: `true`

Exemple (avec détection automatique) :
```typescript
integrations: [
  astroI18nPlugin({
    autoDetectLanguage: true
  })
]
```

Exemple (sans détection automatique) :
```typescript
integrations: [
  astroI18nPlugin({
    autoDetectLanguage: false
  })
]
```

#### `pathBasedRouting`

- **Type **: `boolean`
- **Description **: Indique s'il faut utiliser le routage basé sur le chemin. Si `true`, les langues sont identifiées par les chemins d'URL (par exemple, `/en/about`, `/zh/about`). Si `false`, la langue est déterminée par d'autres moyens (cookie, en-tête Accept-Language) sans modifier le chemin d'URL.
- **Par défaut **: `true`

Cette option détermine le mode de fonctionnement :
- `true` (par défaut) : Mode basé sur le chemin.
- `false` : Mode sans chemin.

Exemple (Basé sur le chemin) :
```typescript
integrations: [
  astroI18nPlugin({
    pathBasedRouting: true
  })
]
```

Exemple (Sans chemin) :
```typescript
integrations: [
  astroI18nPlugin({
    pathBasedRouting: false
  })
]
```

### Configuration du mode basé sur le chemin (pathBasedRouting : true)

Lorsque `pathBasedRouting` est `true`, Astro-i18n fonctionne en mode basé sur le chemin. Toutes les options de configuration communes s'appliquent.

### Configuration du mode sans chemin (pathBasedRouting : false)

Lorsque `pathBasedRouting` est `false`, Astro-i18n fonctionne en mode sans chemin. Toutes les options de configuration communes s'appliquent.

La principale différence réside dans la façon dont la langue est déterminée et comment les URL sont gérées :
- En mode basé sur le chemin, la langue fait partie du chemin d'URL.
- En mode sans chemin, la langue est déterminée par d'autres moyens (cookie, en-tête Accept-Language) et le chemin d'URL reste inchangé.

## Utilisation


### Astro

```astro
---
import { getTranslator } from '@gudupao/astro-i18n';

// Obtenir la langue à partir des paramètres
const lang = Astro.params.lang || 'en';
const t = getTranslator(lang);
---

<div>
  <h1>Test Astro : {t('hello')} {t('123.a')}</h1>
</div>
```

### React

```jsx
import React from 'react';
import { createClientTranslator } from '@gudupao/astro-i18n';
import type { Translations } from '@gudupao/astro-i18n';

const TestComponent = ({ translations }: { translations: Translations }) => {
  const t = createClientTranslator(translations);
  
  return (
    <div>
      <h1>Test React : {t('hello')} {t('123.a')}</h1>
    </div>
  );
};

export default TestComponent;
```

### Vue

```vue
<template>
 <div>
    <h1>Test Vue : {{ t('hello') }} {{ t('123.a') }}</h1>
  </div>
</template>

<script setup lang="ts">
import { createClientTranslator } from '@gudupao/astro-i18n';
import type { Translations } from '@gudupao/astro-i18n';

interface Props {
  translations: Translations;
}

const props = defineProps<Props>();
const t = createClientTranslator(props.translations);
</script>
```

## Exemples de sélecteur de langue

### Version basée sur le chemin

```astro
---
interface Props {
  lang: string;
}

const { lang } = Astro.props;
---

<script is:inline>
 function switchLanguage(language) {
    // Définir le cookie de langue
    document.cookie = `lang=${language}; path=/; max-age=31536000; samesite=lax`;
    console.log('[LanguageSwitcher] Définir le cookie de langue :', language);
    
    const urlParts = window.location.pathname.split('/');
    urlParts[1] = language;
    window.location.href = urlParts.join('/');
  }

  const currentPath = window.location.pathname;
  const urlParts = currentPath.split('/');
</script>

<div class="language-switcher">
  <button
    onclick="switchLanguage('en')"
    class={lang === 'en' ? 'active' : ''}
  >
    English
  </button>
  <button
    onclick="switchLanguage('zh')"
    class={lang === 'zh' ? 'active' : ''}
  >
    中文
  </button>
    <button
    onclick="switchLanguage('jp')"
    class={lang === 'jp' ? 'active' : ''}
  >
    日本語
  </button>
</div>

<style>
.language-switcher {
  display: flex;
  gap: 10px;
  margin-top: 20px;
}

.language-switcher button {
  padding: 5px 10px;
  border: none;
  background: #f0f0f0;
  border-radius: 5px;
  cursor: pointer;
}

.language-switcher button.active {
  background: #007bff;
  color: white;
}
</style>
```

### Version sans chemin

```astro
---
// Obtenir toutes les langues disponibles
const { getAvailableLanguages } = await import('@gudupao/astro-i18n');
const availableLanguages = getAvailableLanguages();

interface Props {
  pathBasedRouting?: boolean; // Indique s'il faut utiliser le mode de routage basé sur le chemin
}

const { pathBasedRouting = true } = Astro.props;

// Fonction pour détecter la langue actuelle
function detectCurrentLanguage() {
  // Vérifier d'abord les paramètres d'URL
  const urlParams = new URLSearchParams(Astro.url.search);
  const langParam = urlParams.get('lang');
  if (langParam) return langParam;

  // Ensuite, vérifier le Cookie
  const cookies = Astro.request.headers.get('cookie');
  if (cookies) {
    const cookieObj = Object.fromEntries(
      cookies.split(';').map(cookie => {
        const [name, value] = cookie.trim().split('=');
        return [name, decodeURIComponent(value)];
      })
    );
    if (cookieObj.lang) return cookieObj.lang;
 }

  // Retourner la langue par défaut
  return 'en';
}

// Obtenir la langue actuelle
const currentLang = detectCurrentLanguage();
---

<div class="language-switcher">
  <h3>Sélecteur de langue (Nouvelle version)</h3>
  <p>Mode actuel : {pathBasedRouting ? 'Routage basé sur le chemin' : 'Routage sans chemin'}</p>
  <div class="switcher-buttons">
    {availableLanguages.map((language) => (
      <button
        data-lang={language}
        class={language === currentLang ? 'active' : ''}
        onclick={`switchLanguage('${language}', ${pathBasedRouting})`}
      >
        {language === 'en' && 'English'}
        {language === 'zh' && '中文'}
        {language === 'jp' && '日本語'}
        {language !== 'en' && language !== 'zh' && language !== 'jp' && language}
      </button>
    ))}
  </div>
</div>

<script is:inline>
  // Fonction pour changer de langue
  function switchLanguage(language, pathBasedRouting) {
    if (pathBasedRouting) {
      // Mode de routage basé sur le chemin
      // Définir le cookie de langue
      document.cookie = `lang=${language}; path=/; max-age=31536000; samesite=lax`;
      console.log('[LanguageSwitcher] Définir le cookie de langue :', language);
      
      const urlParts = window.location.pathname.split('/');
      urlParts[1] = language;
      window.location.href = urlParts.join('/');
    } else {
      // Mode de routage sans chemin
      // Définir le cookie de langue
      document.cookie = `lang=${language}; path=/; max-age=31536000; samesite=lax`;
      // Définir localStorage
      localStorage.setItem('lang', language);
      // Recharger la page pour appliquer la nouvelle langue
      window.location.reload();
    }
  }
</script>

<style>
.language-switcher {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin: 20px 0;
  padding: 15px;
  border: 1px solid #ddd;
  border-radius: 5px;
  background-color: #f9f9f9;
}

.switcher-buttons {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.language-switcher button {
  padding: 8px 12px;
  border: none;
  background: #f0f0f0;
  border-radius: 5px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.language-switcher button:hover {
  background: #e0e0e0;
}

.language-switcher button.active {
  background: #007bff;
  color: white;
}

.language-switcher h3 {
  margin: 0 0 10px 0;
  font-size: 16px;
  color: #333;
}

.language-switcher p {
  margin: 0 0 10px 0;
  font-size: 14px;
  color: #666;
}
</style>
```

## Liens

- Dépôt de code source : [https://github.com/GudupaoSpark/Astro-i18n](https://github.com/GudupaoSpark/Astro-i18n)
- npmjs : [https://www.npmjs.com/package/@gudupao/astro-i18n](https://www.npmjs.com/package/@gudupao/astro-i18n)
- Documentation originale : [https://astro-i18n.gudupao.top](https://astro-i18n.gudupao.top)
